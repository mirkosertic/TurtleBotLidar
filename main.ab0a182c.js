parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"m4Di":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Linesegment=exports.Point=void 0;var i=function(){function e(n,i){t(this,e),this.x=n,this.y=i}return n(e,[{key:"distanceTo",value:function(t){var e=t.x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)}},{key:"polarProjection",value:function(t,n){var i=Math.PI/180*t;return new e(this.x+Math.cos(i)*n,this.y+Math.sin(i)*n)}},{key:"translate",value:function(t,e){this.x+=t,this.y+=e}}]),e}();exports.Point=i;var a=function(){function e(n,i){t(this,e),this.a=n,this.b=i}return n(e,[{key:"intersectionWith",value:function(t){var e=this.b.x-this.a.x,n=this.b.y-this.a.y,a=t.b.x-t.a.x,r=t.b.y-t.a.y,s=(-n*(this.a.x-t.a.x)+e*(this.a.y-t.a.y))/(-a*n+e*r),o=(a*(this.a.y-t.a.y)-r*(this.a.x-t.a.x))/(-a*n+e*r);if(s>=0&&s<=1&&o>=0&&o<=1)return new i(this.a.x+o*e,this.a.y+o*n)}}]),e}();exports.Linesegment=a;
},{}],"Ij9n":[function(require,module,exports) {
"use strict";function t(r){for(var a=0,e=0;0===a;)a=Math.random();for(;0===e;)e=Math.random();var o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*e);return(o=o/10+.5)>1||o<0?t():(o-.5)*r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.gaussianNoise=t;
},{}],"EtCz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TurtleState=void 0;var e=require("./geom.js");function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var t=function t(){n(this,t),this.location=new e.Point(56,56),this.theta=0,this.lidarLength=100,this.lidarNoise=0,this.lidarMinResolution=1,this.walls=[new e.Linesegment(new e.Point(0,0),new e.Point(150,0)),new e.Linesegment(new e.Point(150,0),new e.Point(150,100)),new e.Linesegment(new e.Point(150,100),new e.Point(0,100)),new e.Linesegment(new e.Point(0,0),new e.Point(0,100)),new e.Linesegment(new e.Point(150,80),new e.Point(130,80)),new e.Linesegment(new e.Point(130,100),new e.Point(130,80))]};exports.TurtleState=t;
},{"./geom.js":"m4Di"}],"hLFY":[function(require,module,exports) {
"use strict";function e(e,r,t){return e<0?e+=t:e>=t&&(e-=t),r[e]}function r(r,t,o){for(var i=[],n=0;n<t;n++){var u=e(n,r,t),s=e(n+o,r,t);u&&s&&(i[n]=s-u)}return i}Object.defineProperty(exports,"__esModule",{value:!0}),exports.derivativeOf=r,exports.positionOverflowingValueFrom=e;
},{}],"d6sW":[function(require,module,exports) {
"use strict";var t=require("./geom.js"),e=require("./noise.js"),a=require("./envsim.js"),l=require("./derivative.js"),r=document.getElementById("rendering"),o=r.getContext("2d");o.lineWidth=1,o.strokeStyle="black",o.fillStyle="black",o.scale(2,2),o.translate(100,100);var i=new a.TurtleState,n={particles:[{location:new t.Point(0,0),theta:0,score:1}],estimatedState:function(){for(var e=void 0,a=void 0,l=void 0,r=0;r<this.particles.length;r++){var o=this.particles[r];e=e?(e+o.location.x)/2:o.location.x,a=a?(a+o.location.y)/2:o.location.y,l=l?(l+o.theta)/2:o.theta}return{location:new t.Point(e,a),theta:l}},features:[],featureDetectionRadius:3,moveTurtleBy:function(t,e){for(var a=0;a<this.particles.length;a++){this.particles[a].location.translate(t,e)}this.particles=this.particles.concat([])},rotateTurtle:function(t){for(var e=0;e<this.particles.length;e++){this.particles[e].theta+=t}this.particles=this.particles.concat([])},updateParticleState:function(e){var a=n.estimatedState();if(0===this.features.length)for(var l=0;l<e.length;l++){var r=e[l];this.features.push(a.location.polarProjection(r.angle+a.theta,r.distance))}else{for(var i=0;i<this.particles.length;i++){var s=this.particles[i];s.score=0;for(var c=0;c<this.features.length;c++)for(var h=this.features[c],y=h.x-s.location.x,f=h.y-s.location.y,v=0;v<e.length;v++){var g=e[v],u=new t.Point(0,0).polarProjection(g.angle+s.theta,g.distance);o.beginPath(),o.strokeStyle="gray",o.fillStyle="gray",o.arc(56+s.location.x+u.x,s.location.y+200+u.y,8,0,2*Math.PI),o.stroke(),o.closePath(),o.beginPath(),o.strokeStyle="blue",o.fillStyle="blue",o.arc(56+a.location.x+y,200+a.location.y+f,6,0,2*Math.PI),o.stroke(),o.closePath();var P=Math.abs(u.x-y),d=Math.abs(u.y-f);P<10&&d<10&&(g.identified=!0,s.score+=1)}}for(var k=void 0,S=0;S<this.particles.length;S++)k=k?(k+this.particles[S].score)/2:this.particles[S].score;this.particles=this.particles.filter(function(t,a,l){return t.score>=k||(console.log("Particle "+a+" got score "+t.score+" from "+e.length+" and will be removed!"),!1)})}}},s={smoothing:2.5,enabled:!1,currentValue:[],process:function(t,e){return this.enabled?this.currentValue[t]?(this.currentValue[t]+=(e-this.currentValue[t])/this.smoothing,this.currentValue[t]):(this.currentValue[t]=e,e):e}};function c(t,e,a,l){var r=t.polarProjection(e,a);o.strokeStyle=l,o.fillStyle=l,o.beginPath(),o.moveTo(t.x,t.y),o.lineTo(r.x,r.y),o.stroke(),o.closePath()}function h(t,e,a,l,r,i,n,s,c){for(var h=0;h<r;h++){var y=l[h];if(y){var f=t+(h+i)%r,v=e,g=v+y*n;o.beginPath(),o.strokeStyle=a,o.fillStyle=a,o.moveTo(f,v),o.lineTo(f,g),o.stroke(),o.closePath()}}o.save(),o.beginPath(),o.strokeStyle="black",o.fillStyle="black",o.moveTo(t,e-c),o.lineTo(t,e+c),o.translate(t,e),o.rotate(-Math.PI/2),o.textAlign="center",o.font="8px Arial",o.fillText(s,0,-5),o.stroke(),o.closePath(),o.restore()}function y(){o.clearRect(-100,-100,1e3,1e3),o.strokeStyle="black",o.fillStyle="black",o.textAlign="left",o.font="8px Arial",o.fillText("Reality",-20,-20),o.strokeStyle="black",o.fillStyle="black",o.beginPath();for(var a=0;a<i.walls.length;a++){var r=i.walls[a];o.moveTo(r.a.x,r.a.y),o.lineTo(r.b.x,r.b.y)}o.stroke(),o.closePath(),o.beginPath(),o.strokeStyle="gray",o.fillStyle="gray",o.arc(i.location.x,i.location.y,8,0,2*Math.PI),o.stroke(),o.closePath(),c(i.location,i.theta,20,"green"),o.strokeStyle="black",o.fillStyle="black",o.textAlign="left",o.font="8px Arial",o.fillText("Turtles model no.F. = "+n.features.length+", no. P = "+n.particles.length,-20,120);for(var y=0;y<n.particles.length;y++){var f=n.particles[y];o.beginPath(),o.strokeStyle="gray",o.fillStyle="gray",o.arc(f.x+56,f.y+200,8,0,2*Math.PI),o.stroke(),o.closePath(),c(new t.Point(f.x+56,f.y+200),f.theta,20,"green")}for(var v=0;v<n.features.length;v++){var g=n.features[v];o.beginPath(),o.strokeStyle="red",o.fillStyle="red",o.arc(g.x-1+56,g.y-1+200,3,0,2*Math.PI),o.stroke(),o.closePath()}for(var u=0,P=[],d=[],k=360/i.lidarMinResolution,S=k/2,p=i.theta;p<i.theta+360;p+=i.lidarMinResolution,u++){for(var b=i.location.polarProjection(p,i.lidarLength),x=void 0,m=0;m<i.walls.length;m++){var T=i.walls[m].intersectionWith(new t.Linesegment(i.location,b));if(T){var w=s.process(u,i.location.distanceTo(T)+(0,e.gaussianNoise)(i.lidarNoise));x?x.distance>w&&(x={distance:w,intersection:T}):x={distance:w,intersection:T}}}if(x){P[u]=x.distance,d[u]=p;var M=i.location.polarProjection(p,x.distance);o.beginPath(),o.strokeStyle="CadetBlue",o.fillStyle="CadetBlue",o.arc(M.x,M.y,2,0,2*Math.PI),o.stroke(),o.closePath(),o.beginPath(),0===u?(o.strokeStyle="green",o.fillStyle="green"):(o.strokeStyle="CadetBlue",o.fillStyle="CadetBlue");var I=200+(u+S)%k,A=50-x.distance;o.moveTo(I,50),o.lineTo(I,A),o.stroke(),o.closePath()}else o.strokeStyle="rgba(128,128,128,0.05)",o.fillStyle="rgba(128,128,128,0.05)",o.beginPath(),o.moveTo(i.location.x,i.location.y),o.lineTo(b.x,b.y),o.stroke(),o.closePath()}o.save(),o.beginPath(),o.strokeStyle="black",o.fillStyle="black",o.moveTo(200,50),o.lineTo(200,-70),o.translate(200,50),o.rotate(-Math.PI/2),o.textAlign="center",o.font="8px Arial",o.fillText("Lidar distance",60,-5),o.stroke(),o.closePath(),o.restore();var j=(0,l.derivativeOf)(P,u,1),V=(0,l.derivativeOf)(j,u,1);h(200,90,"DarkSlateGrey",j,k,S,3,"1st derivative",20),h(200,160,"DarkSlateGrey",V,k,S,15,"2nd derivative",20);for(var B=[],q=0;q<u;q++){var F=(0,l.positionOverflowingValueFrom)(q,j,k),R=(0,l.positionOverflowingValueFrom)(q-1,j,k),C=(0,l.positionOverflowingValueFrom)(q,V,k),L=!1;F&&R&&C&&(R>=0&&F<0?L=!0:R<0&&F>.025&&(L=!0));var O=P[q];if(L&&O){var D=d[q],E=i.location.polarProjection(D,O);B.push({angle:D-i.theta,distance:O}),o.beginPath(),o.strokeStyle="red",o.fillStyle="red",o.arc(E.x,E.y,2,0,2*Math.PI),o.stroke(),o.closePath(),o.strokeStyle="lightgray",o.fillStyle="lightgray",o.beginPath(),o.moveTo(i.location.x,i.location.y),o.lineTo(E.x,E.y),o.stroke(),o.closePath();var G=200+(q+S)%k,N=90,W=N-j[q];o.beginPath(),o.strokeStyle="red",o.fillStyle="red",o.arc(G,W,2,0,2*Math.PI),o.stroke(),o.closePath(),G=200+(q+S)%k,W=(N=50)-P[q],o.beginPath(),o.strokeStyle="red",o.fillStyle="red",o.arc(G,W,2,0,2*Math.PI),o.stroke(),o.closePath()}}n.updateParticleState(B)}function f(){y(),window.requestAnimationFrame(f)}window.requestAnimationFrame(f),window.addEventListener("keydown",function(t){if("ArrowUp"===t.key){var e=3*Math.cos(Math.PI/180*i.theta),a=3*Math.sin(Math.PI/180*i.theta);i.location.translate(e,a),n.moveTurtleBy(e,a)}if("ArrowDown"===t.key){var l=-3*Math.cos(Math.PI/180*i.theta),r=-3*Math.sin(Math.PI/180*i.theta);i.location.translate(l,r),n.moveTurtleBy(l,r)}"ArrowLeft"===t.key&&(i.theta-=2,n.rotateTurtle(-2)),"ArrowRight"===t.key&&(i.theta+=2,n.rotateTurtle(2))});
},{"./geom.js":"m4Di","./noise.js":"Ij9n","./envsim.js":"EtCz","./derivative.js":"hLFY"}]},{},["d6sW"], null)
//# sourceMappingURL=main.ab0a182c.js.map