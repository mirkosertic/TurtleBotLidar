parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"d6sW":[function(require,module,exports) {
function t(t,e,a,r,l){var i=a-t,o=r-e;return Math.sqrt(i*i+o*o)+l}function e(t,e,a,r,l,i,o,s){var n,h,c,y,f,u;if(u=((c=o-l)*(e-i)-(y=s-i)*(t-l))/(-c*(h=r-e)+(n=a-t)*y),(f=(-h*(t-l)+n*(e-i))/(-c*h+n*y))>=0&&f<=1&&u>=0&&u<=1)return{x:t+u*n,y:e+u*h}}function a(t,e,a,r,l,i,o){var s,n,h,c,y,f,u,v,x,d;return d={},(x={}).x=i-r,x.y=o-l,d.x=r-t,d.y=l-e,s=x.x*d.x+x.y*d.y,n=2*(x.x*x.x+x.y*x.y),s*=-2,h=Math.sqrt(s*s-2*n*(d.x*d.x+d.y*d.y-a*a)),isNaN(h)?[]:(y=(s+h)/n,u={},v={},f=[],(c=(s-h)/n)<=1&&c>=0&&(u.x=r+x.x*c,u.y=o+x.y*c,f[0]=u),y<=1&&y>=0&&(v.x=r+x.x*y,v.y=o+x.y*y,f[f.length]=v),f)}var r=document.getElementById("rendering"),l=r.getContext("2d"),i=[{x1:0,y1:0,x2:150,y2:0},{x1:150,y1:0,x2:150,y2:100},{x1:150,y1:100,x2:0,y2:100},{x1:0,y1:0,x2:0,y2:100},{x1:150,y1:80,x2:130,y2:80},{x1:130,y1:100,x2:130,y2:80}];l.lineWidth=1,l.strokeStyle="black",l.fillStyle="black",l.scale(2,2),l.translate(100,100);var o={x:56,y:56,theta:0,lidarLength:100,lidarNoise:0,lidarMinResolution:1},s={particles:[{x:0,y:0,theta:0,score:1}],estimatedState:function(){for(var t=void 0,e=void 0,a=void 0,r=0;r<this.particles.length;r++){var l=this.particles[r];t=t?(t+l.x)/2:l.x,e=e?(e+l.y)/2:l.y,a=a?(a+l.theta)/2:l.theta}return{x:t,y:e,theta:a}},randomness:1,features:[],featureDetectionRadius:3,moveTurtleBy:function(t,e){for(var a=[],r=0;r<this.particles.length;r++){var l=this.particles[r];if(l.x+=t,l.y+=e,l.score>0)for(var i=0;i<this.randomness;i++){var o={x:l.x+t+h(30),y:l.y+e+h(30),theta:l.theta+h(10)};a.push(o)}}this.particles=this.particles.concat(a)},rotateTurtle:function(t){for(var e=[],a=0;a<this.particles.length;a++){var r=this.particles[a];if(r.theta+=t,r.score>0)for(var l=0;l<this.randomness;l++){var i={x:r.x+h(5),y:r.y+h(5),theta:r.theta+t+h(10)};e.push(i)}}this.particles=this.particles.concat(e)},updateParticleState:function(t){var e=s.estimatedState();if(0===this.features.length)for(var a=0;a<t.length;a++){var r=t[a],i=Math.PI/180*(r.angle+e.theta),o=e.x+Math.cos(i)*r.distance,n=e.y+Math.sin(i)*r.distance;this.features.push({x:o,y:n})}else{for(a=0;a<this.particles.length;a++){var h=this.particles[a];h.score=0;for(var c=0;c<this.features.length;c++)for(var y=this.features[c],f=y.x-h.x,u=y.y-h.y,v=0;v<t.length;v++){var x=t[v],d=(i=Math.PI/180*(x.angle+h.theta),Math.cos(i)*x.distance),g=Math.sin(i)*x.distance;l.beginPath(),l.strokeStyle="gray",l.fillStyle="gray",l.arc(56+h.x+d,h.y+200+g,8,0,2*Math.PI),l.stroke(),l.closePath(),l.beginPath(),l.strokeStyle="blue",l.fillStyle="blue",l.arc(56+e.x+f,200+e.y+u,6,0,2*Math.PI),l.stroke(),l.closePath();var P=Math.abs(d-f),k=Math.abs(g-u);console.log("dfX = "+P+", dfY = "+k),P<1&&k<1&&(h.score+=1)}}var M=void 0;for(a=0;a<this.particles.length;a++)M=M?(M+this.particles[a].score)/2:this.particles[a].score;this.particles=this.particles.filter(function(e,a,r){return e.score>=M||(console.log("Particle "+a+" got score "+e.score+" from "+t.length+" and will be removed!"),!1)})}}},n={smoothing:2.5,enabled:!1,currentValue:[],process:function(t,e){return this.enabled?this.currentValue[t]?(this.currentValue[t]+=(e-this.currentValue[t])/this.smoothing,this.currentValue[t]):(this.currentValue[t]=e,e):e}};function h(t){for(var e=0,a=0;0===e;)e=Math.random();for(;0===a;)a=Math.random();var r=Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*a);return(r=r/10+.5)>1||r<0?h():(r-.5)*t}function c(t,e,a){return t<0?t+=a:t>=a&&(t-=a),e[t]}var y=function(t,e,a){for(var r=[],l=0;l<e;l++){var i=c(l,t,e),o=c(l+a,t,e);i&&o&&(r[l]=o-i)}return r},f=function(t,e,a,r,i){var o=t+Math.cos(Math.PI/180*a)*r,s=e+Math.sin(Math.PI/180*a)*r;l.strokeStyle=i,l.fillStyle=i,l.beginPath(),l.moveTo(t,e),l.lineTo(o,s),l.stroke(),l.closePath()},u=function(t,e,a,r,i,o,s,n,h){for(var c=0;c<i;c++){var y=r[c];if(y){var f=t+(c+o)%i,u=e,v=u+y*s;l.beginPath(),l.strokeStyle=a,l.fillStyle=a,l.moveTo(f,u),l.lineTo(f,v),l.stroke(),l.closePath()}}l.save(),l.beginPath(),l.strokeStyle="black",l.fillStyle="black",l.moveTo(t,e-h),l.lineTo(t,e+h),l.translate(t,e),l.rotate(-Math.PI/2),l.textAlign="center",l.font="8px Arial",l.fillText(n,0,-5),l.stroke(),l.closePath(),l.restore()},v=function(){l.clearRect(-100,-100,1e3,1e3),l.strokeStyle="black",l.fillStyle="black",l.textAlign="left",l.font="8px Arial",l.fillText("Reality",-20,-20),l.strokeStyle="black",l.fillStyle="black",l.beginPath();for(var a=0;a<i.length;a++){var r=i[a];l.moveTo(r.x1,r.y1),l.lineTo(r.x2,r.y2)}l.stroke(),l.closePath(),l.beginPath(),l.strokeStyle="gray",l.fillStyle="gray",l.arc(o.x,o.y,8,0,2*Math.PI),l.stroke(),l.closePath(),f(o.x,o.y,o.theta,20,"green"),l.strokeStyle="black",l.fillStyle="black",l.textAlign="left",l.font="8px Arial",l.fillText("Turtles model no.F. = "+s.features.length+", no. P = "+s.particles.length,-20,120);for(a=0;a<s.particles.length;a++){var v=s.particles[a];l.beginPath(),l.strokeStyle="gray",l.fillStyle="gray",l.arc(v.x+56,v.y+200,8,0,2*Math.PI),l.stroke(),l.closePath(),f(v.x+56,v.y+200,v.theta,20,"green")}for(a=0;a<s.features.length;a++){var x=s.features[a];l.beginPath(),l.strokeStyle="red",l.fillStyle="red",l.arc(x.x-1+56,x.y-1+200,3,0,2*Math.PI),l.stroke(),l.closePath()}var d=0,g=[],P=[],k=(q=360/o.lidarMinResolution)/2;for(a=o.theta;a<o.theta+360;a+=o.lidarMinResolution,d++){for(var M=o.x+Math.cos(Math.PI/180*a)*o.lidarLength,S=o.y+Math.sin(Math.PI/180*a)*o.lidarLength,b=void 0,p=0;p<i.length;p++){r=i[p];var m=e(o.x,o.y,M,S,r.x1,r.y1,r.x2,r.y2);if(m){var T=n.process(d,t(o.x,o.y,m.x,m.y,h(o.lidarNoise)));b?b.distance>T&&(b={distance:T,intersection:m}):b={distance:T,intersection:m}}}if(b){g[d]=b.distance,P[d]=a;var I=Math.PI/180*a,A=o.x+Math.cos(I)*b.distance,w=o.y+Math.sin(I)*b.distance;l.beginPath(),l.strokeStyle="CadetBlue",l.fillStyle="CadetBlue",l.arc(A,w,2,0,2*Math.PI),l.stroke(),l.closePath(),l.beginPath(),0===d?(l.strokeStyle="green",l.fillStyle="green"):(l.strokeStyle="CadetBlue",l.fillStyle="CadetBlue");var R=200+(d+k)%q,B=(X=50)-b.distance;l.moveTo(R,X),l.lineTo(R,B),l.stroke(),l.closePath()}else l.strokeStyle="rgba(128,128,128,0.05)",l.fillStyle="rgba(128,128,128,0.05)",l.beginPath(),l.moveTo(o.x,o.y),l.lineTo(M,S),l.stroke(),l.closePath()}l.save(),l.beginPath(),l.strokeStyle="black",l.fillStyle="black",l.moveTo(200,50),l.lineTo(200,-70),l.translate(200,50),l.rotate(-Math.PI/2),l.textAlign="center",l.font="8px Arial",l.fillText("Lidar distance",60,-5),l.stroke(),l.closePath(),l.restore();var L=y(g,d,1),V=y(L,d,1),q=360/o.lidarMinResolution;u(200,90,"DarkSlateGrey",L,q,k=q/2,3,"1st derivative",20),u(200,160,"DarkSlateGrey",V,q,k,15,"2nd derivative",20);var C=[];for(a=0;a<d;a++){var D=c(a,L,q),N=c(a-1,L,q),F=c(a,V,q),E=!1;D&&N&&F&&(N>=0&&D<0?E=!0:N<0&&D>.025&&(E=!0));T=g[a];if(E&&T){var G=P[a],U=(I=Math.PI/180*G,o.x+Math.cos(I)*T),W=o.y+Math.sin(I)*T;C.push({angle:G-o.theta,distance:T}),l.beginPath(),l.strokeStyle="red",l.fillStyle="red",l.arc(U,W,2,0,2*Math.PI),l.stroke(),l.closePath(),l.strokeStyle="lightgray",l.fillStyle="lightgray",l.beginPath(),l.moveTo(o.x,o.y),l.lineTo(U,W),l.stroke(),l.closePath();R=200+(a+(k=(q=360/o.lidarMinResolution)/2))%q,B=(X=90)-L[a];l.beginPath(),l.strokeStyle="red",l.fillStyle="red",l.arc(R,B,2,0,2*Math.PI),l.stroke(),l.closePath();var X;R=200+(a+k)%q,B=(X=50)-g[a];l.beginPath(),l.strokeStyle="red",l.fillStyle="red",l.arc(R,B,2,0,2*Math.PI),l.stroke(),l.closePath()}}s.updateParticleState(C)},x=function t(){v(),window.requestAnimationFrame(t)};window.requestAnimationFrame(x),window.addEventListener("keydown",function(t){if("ArrowUp"==t.key){var e=3*Math.cos(Math.PI/180*o.theta),a=3*Math.sin(Math.PI/180*o.theta);o.x+=e,o.y+=a,s.moveTurtleBy(e,a)}if("ArrowDown"==t.key){e=-3*Math.cos(Math.PI/180*o.theta),a=-3*Math.sin(Math.PI/180*o.theta);o.x+=e,o.y+=a,s.moveTurtleBy(e,a)}"ArrowLeft"==t.key&&(o.theta-=2,s.rotateTurtle(-2)),"ArrowRight"==t.key&&(o.theta+=2,s.rotateTurtle(2))});
},{}]},{},["d6sW"], null)
//# sourceMappingURL=main.8f63fb8f.js.map