parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"m4Di":[function(require,module,exports) {
"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Linesegment=exports.Point=void 0;var i=function(){function e(n,i){t(this,e),this.x=n,this.y=i}return n(e,[{key:"distanceTo",value:function(t){var e=t.x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)}},{key:"polarProjection",value:function(t,n){var i=Math.PI/180*t;return new e(this.x+Math.cos(i)*n,this.y+Math.sin(i)*n)}},{key:"translate",value:function(t,e){return this.x+=t,this.y+=e,this}}]),e}();exports.Point=i;var a=function(){function e(n,i){t(this,e),this.a=n,this.b=i}return n(e,[{key:"intersectionWith",value:function(t){var e=this.b.x-this.a.x,n=this.b.y-this.a.y,a=t.b.x-t.a.x,r=t.b.y-t.a.y,s=(-n*(this.a.x-t.a.x)+e*(this.a.y-t.a.y))/(-a*n+e*r),o=(a*(this.a.y-t.a.y)-r*(this.a.x-t.a.x))/(-a*n+e*r);if(s>=0&&s<=1&&o>=0&&o<=1)return new i(this.a.x+o*e,this.a.y+o*n)}}]),e}();exports.Linesegment=a;
},{}],"Ij9n":[function(require,module,exports) {
"use strict";function t(r){for(var a=0,e=0;0===a;)a=Math.random();for(;0===e;)e=Math.random();var o=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*e);return(o=o/10+.5)>1||o<0?t():(o-.5)*r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.gaussianNoise=t;
},{}],"EtCz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TurtleState=void 0;var e=require("./geom.js");function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var t=function t(){n(this,t),this.location=new e.Point(56,56),this.theta=0,this.lidarLength=100,this.lidarNoise=0,this.lidarMinResolution=1,this.walls=[new e.Linesegment(new e.Point(0,0),new e.Point(150,0)),new e.Linesegment(new e.Point(150,0),new e.Point(150,100)),new e.Linesegment(new e.Point(150,100),new e.Point(0,100)),new e.Linesegment(new e.Point(0,0),new e.Point(0,100)),new e.Linesegment(new e.Point(150,80),new e.Point(130,80)),new e.Linesegment(new e.Point(130,100),new e.Point(130,80))]};exports.TurtleState=t;
},{"./geom.js":"m4Di"}],"hLFY":[function(require,module,exports) {
"use strict";function e(e,r,t){return e<0?e+=t:e>=t&&(e-=t),r[e]}function r(r,t,o){for(var i=[],n=0;n<t;n++){var u=e(n,r,t),s=e(n+o,r,t);u&&s&&(i[n]=s-u)}return i}Object.defineProperty(exports,"__esModule",{value:!0}),exports.derivativeOf=r,exports.positionOverflowingValueFrom=e;
},{}],"d6sW":[function(require,module,exports) {
"use strict";var t=require("./geom.js"),e=require("./noise.js"),a=require("./envsim.js"),o=require("./derivative.js"),i=document.getElementById("rendering"),l=i.getContext("2d");l.lineWidth=1,l.strokeStyle="black",l.fillStyle="black",l.scale(2,2),l.translate(100,100);var r=new a.TurtleState,n={particles:[{location:new t.Point(0,0),theta:0,score:1,uncertainty:Math.pow(10,2)}],estimatedState:function(){for(var e=void 0,a=void 0,o=void 0,i=void 0,l=0;l<this.particles.length;l++){var r=this.particles[l];e=e?(e+r.location.x)/2:r.location.x,a=a?(a+r.location.y)/2:r.location.y,o=o?(o+r.theta)/2:r.theta,i=i?(i+r.uncertainty)/2:r.uncertainty}return{location:new t.Point(e,a),theta:o,uncertainty:i}},features:[],featureDetectionRadius:3,moveTurtleBy:function(t,a){for(var o=0;o<this.particles.length;o++){var i=this.particles[o];i.location.translate(t+(0,e.gaussianNoise)(3),a+(0,e.gaussianNoise)(3)),i.uncertainty=Math.pow(10,2)}this.particles=this.particles.concat([])},rotateTurtle:function(t){for(var e=0;e<this.particles.length;e++){var a=this.particles[e];a.theta+=t,a.uncertainty=Math.pow(10,2)}this.particles=this.particles.concat([])},updateParticleState:function(e){var a=n.estimatedState();if(0===this.features.length)for(var o=0;o<e.length;o++){var i=e[o];this.features.push({uncertainty:Math.pow(10,2),location:a.location.polarProjection(i.angle+a.theta,i.distance)})}else{for(var r=0;r<this.particles.length;r++){var s=this.particles[r];s.score=0;for(var c=0;c<this.features.length;c++)for(var h=this.features[c],y=0;y<e.length;y++){var f=e[y],u=new t.Point(0,0).polarProjection(f.angle+s.theta,f.distance).translate(s.location.x,s.location.y);if(l.beginPath(),l.strokeStyle="gray",l.fillStyle="gray",l.arc(56+u.x,200+u.y,8,0,2*Math.PI),l.stroke(),l.closePath(),u.distanceTo(h.location)<10){f.identified=!0,l.beginPath(),l.strokeStyle="blue",l.fillStyle="blue",l.arc(56+u.x,200+u.y,6,0,2*Math.PI),l.stroke(),l.closePath(),s.score+=1;var g=h.location.distanceTo(s.location),v=a.uncertainty/(a.uncertainty+f.uncertainty);s.uncertainty=(1-v)*a.uncertainty;var d=g+v*(f.distance-g),P=s.location;s.location=h.location.polarProjection(f.angle+s.theta+180,d),h.location=P.polarProjection(f.angle+s.theta,d)}}}for(var k=void 0,S=0;S<this.particles.length;S++)k=k?(k+this.particles[S].score)/2:this.particles[S].score;this.particles=this.particles.filter(function(t,a,o){return t.score>=k||(console.log("Particle "+a+" got score "+t.score+" from "+e.length+" and will be removed!"),!1)})}}},s={smoothing:2,enabled:!1,window:[],sum:void 0,process:function(t,e){return this.enabled?(this.sum?this.sum+=e:this.sum=e,this.window.push(e),this.window.length<=this.smoothing?this.sum/this.window.length:(this.sum-=this.window.shift(),this.sum/this.smoothing)):e}};function c(t,e,a,o){var i=t.polarProjection(e,a);l.strokeStyle=o,l.fillStyle=o,l.beginPath(),l.moveTo(t.x,t.y),l.lineTo(i.x,i.y),l.stroke(),l.closePath()}function h(t,e,a,o,i,r,n,s,c){for(var h=0;h<i;h++){var y=o[h];if(y){var f=t+(h+r)%i,u=e,g=u+y*n;l.beginPath(),l.strokeStyle=a,l.fillStyle=a,l.moveTo(f,u),l.lineTo(f,g),l.stroke(),l.closePath()}}l.save(),l.beginPath(),l.strokeStyle="black",l.fillStyle="black",l.moveTo(t,e-c),l.lineTo(t,e+c),l.translate(t,e),l.rotate(-Math.PI/2),l.textAlign="center",l.font="8px Arial",l.fillText(s,0,-5),l.stroke(),l.closePath(),l.restore()}function y(){l.clearRect(-100,-100,1e3,1e3),l.strokeStyle="black",l.fillStyle="black",l.textAlign="left",l.font="8px Arial",l.fillText("Reality",-20,-20),l.strokeStyle="black",l.fillStyle="black",l.beginPath();for(var a=0;a<r.walls.length;a++){var i=r.walls[a];l.moveTo(i.a.x,i.a.y),l.lineTo(i.b.x,i.b.y)}l.stroke(),l.closePath(),l.beginPath(),l.strokeStyle="gray",l.fillStyle="gray",l.arc(r.location.x,r.location.y,8,0,2*Math.PI),l.stroke(),l.closePath(),c(r.location,r.theta,20,"green"),l.strokeStyle="black",l.fillStyle="black",l.textAlign="left",l.font="8px Arial",l.fillText("Turtles model no.F. = "+n.features.length+", no. P = "+n.particles.length,-20,120);for(var y=0;y<n.particles.length;y++){var f=n.particles[y];l.beginPath(),l.strokeStyle="gray",l.fillStyle="gray",l.arc(f.location.x+56,f.location.y+200,8,0,2*Math.PI),l.stroke(),l.closePath(),c(new t.Point(f.location.x+56,f.location.y+200),f.theta,20,"green"),l.strokeStyle="black",l.fillStyle="black",l.textAlign="left",l.font="8px Arial",l.fillText("Uncertainty:",f.location.x+46,f.location.y+170),l.fillText(f.uncertainty.toPrecision(4),f.location.x+46,f.location.y+180)}for(var u=0;u<n.features.length;u++){var g=n.features[u];l.beginPath(),l.strokeStyle="red",l.fillStyle="red",l.arc(g.location.x-1+56,g.location.y-1+200,3,0,2*Math.PI),l.stroke(),l.closePath()}for(var v=0,d=[],P=[],k=360/r.lidarMinResolution,S=k/2,p=r.theta;p<r.theta+360;p+=r.lidarMinResolution,v++){for(var w=r.location.polarProjection(p,r.lidarLength),b=void 0,m=0;m<r.walls.length;m++){var x=r.walls[m].intersectionWith(new t.Linesegment(r.location,w));if(x){var T=s.process(v,r.location.distanceTo(x)+(0,e.gaussianNoise)(r.lidarNoise));b?b.distance>T&&(b={distance:T,intersection:x}):b={distance:T,intersection:x}}}if(b){d[v]=b.distance,P[v]=p;var M=r.location.polarProjection(p,b.distance);l.beginPath(),l.strokeStyle="CadetBlue",l.fillStyle="CadetBlue",l.arc(M.x,M.y,2,0,2*Math.PI),l.stroke(),l.closePath(),l.beginPath(),0===v?(l.strokeStyle="green",l.fillStyle="green"):(l.strokeStyle="CadetBlue",l.fillStyle="CadetBlue");var A=200+(v+S)%k,I=50-b.distance;l.moveTo(A,50),l.lineTo(A,I),l.stroke(),l.closePath()}else l.strokeStyle="rgba(128,128,128,0.05)",l.fillStyle="rgba(128,128,128,0.05)",l.beginPath(),l.moveTo(r.location.x,r.location.y),l.lineTo(w.x,w.y),l.stroke(),l.closePath()}l.save(),l.beginPath(),l.strokeStyle="black",l.fillStyle="black",l.moveTo(200,50),l.lineTo(200,-70),l.translate(200,50),l.rotate(-Math.PI/2),l.textAlign="center",l.font="8px Arial",l.fillText("Lidar distance",60,-5),l.stroke(),l.closePath(),l.restore();var j=(0,o.derivativeOf)(d,v,1),B=(0,o.derivativeOf)(j,v,1);h(200,90,"DarkSlateGrey",j,k,S,3,"1st derivative",20),h(200,160,"DarkSlateGrey",B,k,S,15,"2nd derivative",20);for(var q=[],F=0;F<v;F++){var R=(0,o.positionOverflowingValueFrom)(F,j,k),C=(0,o.positionOverflowingValueFrom)(F-1,j,k),L=(0,o.positionOverflowingValueFrom)(F,B,k),O=!1;R&&C&&L&&(C>=0&&R<0?O=!0:C<0&&R>.025&&(O=!0));var D=d[F];if(O&&D){var N=P[F],V=r.location.polarProjection(N,D);q.push({angle:N-r.theta,distance:D,uncertainty:Math.pow(5,2)}),l.beginPath(),l.strokeStyle="red",l.fillStyle="red",l.arc(V.x,V.y,2,0,2*Math.PI),l.stroke(),l.closePath(),l.strokeStyle="lightgray",l.fillStyle="lightgray",l.beginPath(),l.moveTo(r.location.x,r.location.y),l.lineTo(V.x,V.y),l.stroke(),l.closePath();var E=200+(F+S)%k,G=90,U=G-j[F];l.beginPath(),l.strokeStyle="red",l.fillStyle="red",l.arc(E,U,2,0,2*Math.PI),l.stroke(),l.closePath(),E=200+(F+S)%k,U=(G=50)-d[F],l.beginPath(),l.strokeStyle="red",l.fillStyle="red",l.arc(E,U,2,0,2*Math.PI),l.stroke(),l.closePath()}}n.updateParticleState(q)}function f(){y(),window.requestAnimationFrame(f)}window.requestAnimationFrame(f),window.addEventListener("keydown",function(t){if("ArrowUp"===t.key){var e=3*Math.cos(Math.PI/180*r.theta),a=3*Math.sin(Math.PI/180*r.theta);r.location.translate(e,a),n.moveTurtleBy(e,a)}if("ArrowDown"===t.key){var o=-3*Math.cos(Math.PI/180*r.theta),i=-3*Math.sin(Math.PI/180*r.theta);r.location.translate(o,i),n.moveTurtleBy(o,i)}"ArrowLeft"===t.key&&(r.theta-=2,n.rotateTurtle(-2)),"ArrowRight"===t.key&&(r.theta+=2,n.rotateTurtle(2))});
},{"./geom.js":"m4Di","./noise.js":"Ij9n","./envsim.js":"EtCz","./derivative.js":"hLFY"}]},{},["d6sW"], null)
//# sourceMappingURL=main.37318312.js.map